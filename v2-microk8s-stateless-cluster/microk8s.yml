
- name: Get installed apt packages list
  package_facts:
    manager: "auto"

- name: Install a list of packages
  apt:
      name: '{{ packages }}'
      update_cache: true
  vars:
      packages:
          - snapd
  when: "('snapd' not in ansible_facts.packages)"

- snap:
    name: microk8s
    classic: yes
    channel: 1.19/stable
    state: present

#- shell: snap refresh microk8s --channel=1.19/stable    
- shell: microk8s status --wait-ready
- shell: microk8s add-node | grep "microk8s join" | head -n2 | tail -n1
- shell: microk8s leave

# TODO join automatically

